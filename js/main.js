import { connect, updateAccount } from "./account.js";
import { makeSign, makeTransaction } from "./transactions.js";
// import { Buffer } from "buffer";

// Buffer.from("anything", "base64");
// window.Buffer = window.Buffer || Buffer;

document.addEventListener("DOMContentLoaded", () => {
  console.log("Script loaded...");

  window.ethereum.on("accountsChanged", function (accounts) {
    addr = accounts[0];
    updateAccount(web3, addr);
  });

  window.ethereum.on("chainChanged", function (networkId) {
    updateAccount(web3, addr);
  });

  let web3, addr;

  const connectBtn = document.querySelector("#connect-btn");
  const transactBtn = document.querySelector("#transact-btn");
  const singBtn = document.querySelector("#sign-btn");
  const singInput = document.querySelector("#sign-input");

  connectBtn.addEventListener("click", async () => {
    [web3, addr] = await connect();

    await updateAccount(web3, addr);
    setInterval(async () => {
      await updateAccount(web3, addr);
    }, 5000);
  });

  singBtn.addEventListener("click", async () => {
    await makeSign(web3, addr, singInput.value);
  });

  transactBtn.addEventListener("click", async () => {
    console.log("Starting to transfer funds...");
    await makeTransaction(web3, addr, singInput.value);
  });
});
